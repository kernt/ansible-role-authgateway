---
# Configure requirements first.
- hosts: localhost
  remote_user: root
  roles:
    - role: stefano-pogliani.upstream-nginx
      # Systemd and docker don't go together.
      upstream_nginx_service_manage: false
  tasks:
    - import_tasks: 'tests/tests/nodejs.yml'


# Then execute this role once all it good.
- hosts: localhost
  remote_user: root
  roles:
    - role: authgateway
      authgateway_configure_oauth2_proxy: true
      authgateway_conf_domain: 'gate.example.com'
      authgateway_conf_client_id: 'some id'
      authgateway_conf_client_secret: 'some secret'
      authgateway_conf_provider: 'github'
      authgateway_conf_session_secret: 'some secret generated by user'
      authgateway_extra_emails:
        - 'test1@example.com'
        - 'test2@example.com'
      authgateway_acmetool_target: '/opt/authgateway/acmetool.wants'
      authgateway_conf_apps:
        - name: Google
          url: 'https://www.google.co.uk/'
        - name: Test
          upstream:
            host: 'localhost:1234'
            protocol: 'http'
